dataset_type = 'LoadDatasets'

data_root = '/home/datasets/mix_data/vilbert/datasets/'
task_ids = '1',

# test mode directly read this data set
test_datasets = ['minval']
'''
test_datasets = ['minval']  # for TASK1
test_datasets = ['val']  # for TASK2
test_datasets = ['val']  # for TASK3
test_datasets = ['val']  # for TASK4
test_datasets = ['val']  # for TASK5
test_datasets = ['val']  # for TASK6
test_datasets = ['val']  # for TASK7
test_datasets = ['val']  # for TASK8
test_datasets = ['val']  # for TASK9
test_datasets = ['val']  # for TASK10
test_datasets = ['val']  # for TASK11
test_datasets = ['dev']  # for TASK12
test_datasets = ['dev']  # for TASK13
test_datasets = ['valid']   # for TASK14
test_datasets = ['minval']  # for TASK15
test_datasets = ['val']     # for TASK16
test_datasets = ['valid']   # for TASK17
test_datasets = ['val']     # for TASK18
'''
limit_nums = None

vqa_reader_train_cfg = dict(
    tasks=task_ids,
    bert_model='bert-base-uncased',
    do_lower_case=True,
    gradient_accumulation_steps=1,
    in_memory=False,  # whether use chunck for parallel training
    clean_datasets=True,  # whether clean train sets for multitask data
    # limit_nums=limit_nums,
    TASK1=dict(
        name='VQA',
        dataroot=data_root + 'VQA/',
        features_h5path1=data_root + 'coco/features_100/COCO_trainval_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2='',
        annotations_jsonpath='',
        max_seq_length=23,
        max_region_num=101,
        split='trainval'),
    TASK2=dict(
        name='GenomeQA',
        dataroot=data_root + 'visual_genome/',
        features_h5path1=data_root + 'visual_genome/vg_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2='',
        annotations_jsonpath='',
        max_seq_length=26,
        max_region_num=101,
        split='train'),
    TASK3=dict(
        name='VisualDialog',
        dataroot=data_root + 'visual_dialog/',
        features_h5path1=data_root + 'coco/features_100/COCO_trainval_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2='',
        annotations_jsonpath=data_root + 'visual_dialog/visdial_1.0_train.json',
        max_seq_length=16,
        max_region_num=101,
        split='train'),
    TASK4=dict(
        name='Visual7w',
        dataroot=data_root + 'visual7w/',
        features_h5path1=data_root + 'visual7w/visual7w_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2=data_root + 'visual7w/visual7w_gt_resnext152_faster_rcnn_genome.lmdb',
        annotations_jsonpath='',
        max_seq_length=20,
        max_region_num=200,
        split='train'),
    TASK5=dict(
        name='VCR_Q-A',
        dataroot=data_root + 'CVR/',
        features_h5path1=data_root + 'VCR/VCR_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2=data_root + 'VCR/VCR_gt_resnext152_faster_rcnn_genome.lmdb',
        annotations_jsonpath=data_root + 'VCR/train.jsonl',
        max_seq_length=60,
        max_region_num=101,
        split='train'),
    TASK6=dict(
        name='VCR_QA-R',
        dataroot=data_root + 'CVR/',
        features_h5path1=data_root + 'VCR/VCR_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2=data_root + 'VCR/VCR_gt_resnext152_faster_rcnn_genome.lmdb',
        annotations_jsonpath=data_root + 'VCR/train.jsonl',
        max_seq_length=80,
        max_region_num=101,
        split='train'),
    TASK7=dict(
        name='RetrievalCOCO',
        dataroot=data_root + 'cocoRetreival/',
        features_h5path1=data_root + 'coco/features_100/COCO_trainval_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2='',
        annotations_jsonpath=data_root + 'cocoRetreival/all_data_final_train_2014.jsonline',
        max_seq_length=30,
        max_region_num=101,
        split='train'),
    TASK8=dict(
        name='RetrievalFlickr30k',
        dataroot=data_root + 'flickr30k/',
        features_h5path1=data_root + 'flickr30k/flickr30k_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2='',
        annotations_jsonpath=data_root + 'flickr30k/all_data_final_train_2014.jsonline',
        max_seq_length=30,
        max_region_num=101,
        split='train'),
    TASK9=dict(
        name='refcoco',
        dataroot=data_root + 'refcoco/',
        features_h5path1=data_root + 'refcoco/refcoco_unc/refcoco_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2=data_root + 'refcoco/refcoco_unc/refcoco_gt_resnext152_faster_rcnn_genome.lmdb',
        annotations_jsonpath='',
        max_seq_length=20,
        max_region_num=101,
        split='train'),
    TASK10=dict(
        name='refcoco+',
        dataroot=data_root + 'refcoco/',
        features_h5path1=data_root + 'refcoco/refcoco+_unc/refcoco+_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2=data_root + 'refcoco/refcoco+_unc/refcoco+_gt_resnext152_faster_rcnn_genome.lmdb',
        annotations_jsonpath='',
        max_seq_length=20,
        max_region_num=101,
        split='train'),
    TASK11=dict(
        name='refcocog',
        dataroot=data_root + 'refcoco/',
        features_h5path1=data_root + 'refcoco/refcocog_umd/refcocog_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2=data_root + 'refcoco/refcocog_umd/refcocog_gt_resnext152_faster_rcnn_genome.lmdb',
        annotations_jsonpath='',
        max_seq_length=20,
        max_region_num=101,
        split='train'),
    TASK12=dict(
        name='NLVR2',
        dataroot=data_root + 'nlvr2/',
        features_h5path1=data_root + 'nlvr2/nlvr2_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2='',
        annotations_jsonpath='',
        max_seq_length=40,
        max_region_num=101,
        split='train'),
    TASK13=dict(
        name='VisualEntailment',
        dataroot=data_root + 'visual_entailment/',
        features_h5path1=data_root + 'flickr30k/flickr30k_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2='',
        annotations_jsonpath='',
        max_seq_length=56,
        max_region_num=101,
        split='train'),
    TASK14=dict(
        name='GuessWhat',
        dataroot=data_root + 'guesswhat/',
        features_h5path1=data_root + 'coco/features_100/COCO_trainval_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2='',
        annotations_jsonpath='',
        max_seq_length=25,
        max_region_num=101,
        split='train'),
    TASK15=dict(
        name='GQA',
        dataroot=data_root + 'gqa/',
        features_h5path1=data_root + 'gqa/gqa_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2='',
        annotations_jsonpath='',
        max_seq_length=26,
        max_region_num=101,
        split='trainval'),
    TASK16=dict(
        name='Foil',
        dataroot=data_root + 'Foil/',
        features_h5path1=data_root + 'coco/features_100/COCO_trainval_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2='',
        annotations_jsonpath=data_root + 'Foil/foilv1.0_train_2017.json',
        max_seq_length=20,
        max_region_num=101,
        split='train'),
    TASK17=dict(
        name='GuessWhatPointing',
        dataroot=data_root + 'guesswhat/',
        features_h5path1=data_root + 'coco/features_100/COCO_trainval_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2=data_root + 'guesswhat/guesswhat_gt_resnext152_faster_rcnn_genome.lmdb',
        annotations_jsonpath='',
        max_seq_length=256,
        max_region_num=306,
        split='train'),
    TASK18=dict(
        name='FlickrGrounding',
        dataroot=data_root + 'flickr30k/',
        features_h5path1=data_root + 'flickr30k/flickr30k_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2=data_root + 'flickr30k/flickr30k_gt_resnext152_faster_rcnn_genome.lmdb',
        annotations_jsonpath='',
        max_seq_length=24,
        max_region_num=200,
        split='train'),
)

vqa_reader_test_cfg = dict(
    tasks=task_ids,
    bert_model='bert-base-uncased',
    do_lower_case=True,
    gradient_accumulation_steps=1,
    in_memory=False,
    clean_datasets=True,
    # limit_nums=limit_nums,
    TASK1=dict(
        name='VQA',
        dataroot=data_root + 'VQA/',
        features_h5path1=data_root + 'coco/features_100/COCO_trainval_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2='',
        annotations_jsonpath='',
        max_seq_length=23,
        max_region_num=101,
        split='minval',
    ),
    TASK2=dict(
        name='GenomeQA',
        dataroot=data_root + 'visual_genome/',
        features_h5path1=data_root + 'visual_genome/vg_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2='',
        annotations_jsonpath='',
        max_seq_length=26,
        max_region_num=101,
        split='val'),
    TASK3=dict(
        name='VisualDialog',
        dataroot=data_root + 'visual_dialog/',
        features_h5path1=data_root + 'coco/features_100/COCO_trainval_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2='',
        annotations_jsonpath=data_root + 'visual_dialog/visdial_1.0_val.json',
        max_seq_length=16,
        max_region_num=101,
        split='val'),
    TASK4=dict(
        name='Visual7w',
        dataroot=data_root + 'visual7w/',
        features_h5path1=data_root + 'visual7w/visual7w_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2=data_root + 'visual7w/visual7w_gt_resnext152_faster_rcnn_genome.lmdb',
        annotations_jsonpath='',
        max_seq_length=20,
        max_region_num=200,
        split='val'),
    TASK5=dict(
        name='VCR_Q-A',
        dataroot=data_root + 'CVR/',
        features_h5path1=data_root + 'VCR/VCR_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2=data_root + 'VCR/VCR_gt_resnext152_faster_rcnn_genome.lmdb',
        annotations_jsonpath=data_root + 'VCR/val.jsonl',
        max_seq_length=60,
        max_region_num=101,
        split='val'),
    TASK6=dict(
        name='VCR_QA-R',
        dataroot=data_root + 'CVR/',
        features_h5path1=data_root + 'VCR/VCR_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2=data_root + 'VCR/VCR_gt_resnext152_faster_rcnn_genome.lmdb',
        annotations_jsonpath=data_root + 'VCR/val.jsonl',
        max_seq_length=80,
        max_region_num=101,
        split='val'),
    TASK7=dict(
        name='RetrievalCOCO',
        dataroot=data_root + 'cocoRetreival/',
        features_h5path1=data_root + 'coco/features_100/COCO_trainval_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2='',
        annotations_jsonpath=data_root + 'cocoRetreival/all_data_final_test_set0_2014.jsonline',
        max_seq_length=30,
        max_region_num=101,
        split='val'),
    TASK8=dict(
        name='RetrievalFlickr30k',
        dataroot=data_root + 'flickr30k/',
        features_h5path1=data_root + 'flickr30k/flickr30k_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2='',
        annotations_jsonpath=data_root + 'flickr30k/all_data_final_test_set0_2014.jsonline',
        max_seq_length=30,
        max_region_num=101,
        split='val'),
    TASK9=dict(
        name='refcoco',
        dataroot=data_root + 'refcoco/',
        features_h5path1=data_root + 'refcoco/refcoco_unc/refcoco_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2=data_root + 'refcoco/refcoco_unc/refcoco_gt_resnext152_faster_rcnn_genome.lmdb',
        annotations_jsonpath='',
        max_seq_length=20,
        max_region_num=101,
        split='val'),
    TASK10=dict(
        name='refcoco+',
        dataroot=data_root + 'refcoco/',
        features_h5path1=data_root + 'refcoco/refcoco+_unc/refcoco+_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2=data_root + 'refcoco/refcoco+_unc/refcoco+_gt_resnext152_faster_rcnn_genome.lmdb',
        annotations_jsonpath='',
        max_seq_length=20,
        max_region_num=101,
        split='val'),
    TASK11=dict(
        name='refcocog',
        dataroot=data_root + 'refcoco/',
        features_h5path1=data_root + 'refcoco/refcocog_umd/refcocog_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2=data_root + 'refcoco/refcocog_umd/refcocog_gt_resnext152_faster_rcnn_genome.lmdb',
        annotations_jsonpath='',
        max_seq_length=20,
        max_region_num=101,
        split='val'),
    TASK12=dict(
        name='NLVR2',
        dataroot=data_root + 'nlvr2/',
        features_h5path1=data_root + 'nlvr2/nlvr2_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2='',
        annotations_jsonpath='',
        max_seq_length=40,
        max_region_num=101,
        split='dev'),
    TASK13=dict(
        name='VisualEntailment',
        dataroot=data_root + 'visual_entailment/',
        features_h5path1=data_root + 'flickr30k/flickr30k_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2='',
        annotations_jsonpath='',
        max_seq_length=56,
        max_region_num=101,
        split='dev'),
    TASK14=dict(
        name='GuessWhat',
        dataroot=data_root + 'guesswhat/',
        features_h5path1=data_root + 'coco/features_100/COCO_trainval_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2='',
        annotations_jsonpath='',
        max_seq_length=25,
        max_region_num=101,
        split='valid'),
    TASK15=dict(
        name='GQA',
        dataroot=data_root + 'gqa/',
        features_h5path1=data_root + 'gqa/gqa_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2='',
        annotations_jsonpath='',
        max_seq_length=26,
        max_region_num=101,
        split='minval'),
    TASK16=dict(
        name='Foil',
        dataroot=data_root + 'Foil/',
        features_h5path1=data_root + 'coco/features_100/COCO_trainval_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2='',
        annotations_jsonpath=data_root + 'Foil/foilv1.0_test_2017.json',
        max_seq_length=20,
        max_region_num=101,
        split='val'),
    TASK17=dict(
        name='GuessWhatPointing',
        dataroot=data_root + 'guesswhat/',
        features_h5path1=data_root + 'coco/features_100/COCO_trainval_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2=data_root + 'guesswhat/guesswhat_gt_resnext152_faster_rcnn_genome.lmdb',
        annotations_jsonpath='',
        max_seq_length=256,
        max_region_num=306,
        split='valid'),
    TASK18=dict(
        name='FlickrGrounding',
        dataroot=data_root + 'flickr30k/',
        features_h5path1=data_root + 'flickr30k/flickr30k_resnext152_faster_rcnn_genome.lmdb',
        features_h5path2=data_root + 'flickr30k/flickr30k_gt_resnext152_faster_rcnn_genome.lmdb',
        annotations_jsonpath='',
        max_seq_length=24,
        max_region_num=200,
        split='val'),
)

train_data = dict(
    samples_per_gpu=32,
    workers_per_gpu=1,
    sampler_name='TrainingSampler',
    data=dict(
        type=dataset_type,
        reader=vqa_reader_train_cfg,
    ),
    pin_memory=True,
    sampler='RandomSampler',
)
'''
samples_per_gpu=128,    # for TASK1
samples_per_gpu=128,    # for TASK2
samples_per_gpu=64,     # for TASK3
samples_per_gpu=256,    # for TASK4
samples_per_gpu=64,     # for TASK5
samples_per_gpu=64,     # for TASK6
samples_per_gpu=128,    # for TASK7
samples_per_gpu=128,    # for TASK8
samples_per_gpu=256,    # for TASK9
samples_per_gpu=256,    # for TASK10
samples_per_gpu=256,    # for TASK11
samples_per_gpu=64,     # for TASK12
samples_per_gpu=256,    # for TASK13
samples_per_gpu=256,    # for TASK14
samples_per_gpu=128,    # for TASK15
samples_per_gpu=256,    # for TASK16
samples_per_gpu=64,     # for TASK17
samples_per_gpu=256,    # for TASK18
'''
test_data = dict(
    samples_per_gpu=32,
    workers_per_gpu=1,
    sampler_name='TestingSampler',
    data=dict(type=dataset_type, reader=vqa_reader_test_cfg),
    pin_memory=True,
    eval_period=5000)  # eval_period set to 0 to disable
'''
samples_per_gpu=1024,   # for TASK1
samples_per_gpu=1024,   # for TASK2
samples_per_gpu=64,     # for TASK3
samples_per_gpu=256,    # for TASK4
samples_per_gpu=64,     # for TASK5
samples_per_gpu=64,     # for TASK6
samples_per_gpu=128,    # for TASK7
samples_per_gpu=128,    # for TASK8
samples_per_gpu=256,    # for TASK9
samples_per_gpu=1024,   # for TASK10
samples_per_gpu=256,    # for TASK11
samples_per_gpu=512,    # for TASK12
samples_per_gpu=1024,   # for TASK13
samples_per_gpu=1024,   # for TASK14
samples_per_gpu=1024,   # for TASK15
samples_per_gpu=1024,   # for TASK16
samples_per_gpu=64,     # for TASK17
samples_per_gpu=256,    # for TASK18
'''
post_processor = dict(
    type='Evaluator',
    metrics=[dict(type='VILBERT_AccuracyMetric')],
    dataset_converters=[dict(type='VILBERT_DatasetConverter')])
